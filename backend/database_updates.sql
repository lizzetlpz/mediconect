-- Tabla para almacenar mensajes de chat en tiempo real\nCREATE TABLE IF NOT EXISTS mensajes_chat (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    consulta_id INT NOT NULL,\n    remitente_id INT NOT NULL,\n    remitente_tipo ENUM('paciente', 'medico') NOT NULL,\n    nombre_remitente VARCHAR(255) NOT NULL,\n    texto TEXT NOT NULL,\n    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    leido BOOLEAN DEFAULT FALSE,\n    \n    INDEX idx_consulta_timestamp (consulta_id, timestamp),\n    INDEX idx_remitente (remitente_id),\n    \n    FOREIGN KEY (remitente_id) REFERENCES usuarios(usuario_id) ON DELETE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n\n-- Tabla para gestionar sesiones de videollamadas\nCREATE TABLE IF NOT EXISTS videollamadas (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    consulta_id INT NOT NULL,\n    iniciada_por INT NOT NULL,\n    estado ENUM('activa', 'finalizada') DEFAULT 'activa',\n    timestamp_inicio TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    timestamp_fin TIMESTAMP NULL,\n    duracion_segundos INT NULL,\n    \n    INDEX idx_consulta (consulta_id),\n    \n    FOREIGN KEY (consulta_id) REFERENCES citas(cita_id) ON DELETE CASCADE,\n    FOREIGN KEY (iniciada_por) REFERENCES usuarios(usuario_id) ON DELETE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n\n-- Actualizar tabla de citas para agregar campo de modalidad si no existe\nALTER TABLE citas \nADD COLUMN IF NOT EXISTS modalidad ENUM('texto', 'video', 'videollamada') DEFAULT 'texto' \nAFTER notas;\n\n-- Agregar Ã­ndices adicionales para mejor rendimiento\nCREATE INDEX IF NOT EXISTS idx_citas_estado ON citas(estado);\nCREATE INDEX IF NOT EXISTS idx_citas_medico_estado ON citas(medico_id, estado);\nCREATE INDEX IF NOT EXISTS idx_citas_paciente_estado ON citas(paciente_id, estado);
