<div class="medical-ai-container">
  <!-- Header del Chat de IA -->
  <div class="ai-chat-header">
    <div class="ai-info">
      <div class="ai-avatar">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z">
          </path>
        </svg>
      </div>
      <div class="ai-details">
        <h3>Asistente M√©dico IA</h3>
        <p>Evaluaci√≥n preliminar de s√≠ntomas</p>
      </div>
    </div>
    
    <div class="ai-status" [ngClass]="{'activo': conversacionActiva}">
      <span class="status-indicator"></span>
      <span class="status-text">{{ conversacionActiva ? 'En l√≠nea' : 'Disponible' }}</span>
    </div>
  </div>

  <!-- Estado inicial - No hay conversaci√≥n -->
  <div class="ai-welcome" *ngIf="!conversacionActiva && mensajes.length === 0">
    <div class="welcome-content">
      <div class="welcome-icon">
        ü§ñ
      </div>
      <h2>¬°Hola! Soy tu Asistente M√©dico Virtual</h2>
      <p>Puedo ayudarte con una evaluaci√≥n preliminar de tus s√≠ntomas cuando no hay m√©dicos disponibles.</p>
      
      <div class="features-list">
        <div class="feature">
          <span class="feature-icon">‚ùì</span>
          <span>An√°lisis de s√≠ntomas</span>
        </div>
        <div class="feature">
          <span class="feature-icon">üìã</span>
          <span>Recomendaciones b√°sicas</span>
        </div>
        <div class="feature">
          <span class="feature-icon">‚ö†Ô∏è</span>
          <span>Alertas de urgencia</span>
        </div>
      </div>

      <button class="btn-iniciar-chat" (click)="iniciarConversacion()">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z">
          </path>
        </svg>
        Iniciar Evaluaci√≥n
      </button>

      <div class="disclaimer">
        <p><strong>Nota:</strong> Este asistente no reemplaza la consulta m√©dica profesional.</p>
      </div>
    </div>
  </div>

  <!-- Chat activo -->
  <ng-container *ngIf="conversacionActiva || mensajes.length > 0">
    <!-- Mensajes del chat -->
    <div class="chat-messages" #chatMessages>
      <div class="message" 
           *ngFor="let mensaje of mensajes"
           [class.mensaje-ia]="mensaje.remitente === 'ia'"
           [class.mensaje-paciente]="mensaje.remitente === 'paciente'"
           [class.mensaje-diagnostico]="esDiagnostico(mensaje)">
        
        <div class="message-avatar">
          {{ getIniciales(mensaje.remitente) }}
        </div>
        
        <div class="message-content">
          <div class="message-header">
            <span class="sender-name">
              {{ mensaje.remitente === 'ia' ? 'Asistente IA' : 'T√∫' }}
            </span>
            <span class="message-time">
              {{ formatearTiempo(mensaje.timestamp) }}
            </span>
          </div>
          
          <div class="message-bubble" [class.diagnostico]="esDiagnostico(mensaje)">
            <div *ngIf="!esDiagnostico(mensaje); else diagnosticoTemplate">
              {{ mensaje.texto }}
            </div>
            
            <ng-template #diagnosticoTemplate>
              <div class="diagnostico-content" [innerHTML]="mensaje.texto | nl2br"></div>
            </ng-template>
          </div>
        </div>
      </div>
      
      <!-- Indicador de escritura -->
      <div class="message mensaje-ia typing" *ngIf="escribiendo">
        <div class="message-avatar">IA</div>
        <div class="message-content">
          <div class="message-bubble">
            <div class="typing-indicator">
              <span></span>
              <span></span>
              <span></span>
            </div>
            <small>El asistente est√° escribiendo...</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Input de respuesta -->
    <div class="chat-input-container" *ngIf="conversacionActiva">
      <div class="chat-input-wrapper">
        <textarea
          class="chat-input"
          placeholder="Escribe tu respuesta aqu√≠..."
          rows="2"
          [(ngModel)]="nuevaRespuesta"
          (keypress)="onKeyPress($event)"
          [disabled]="escribiendo"
        ></textarea>
        
        <button class="btn-enviar" 
                (click)="enviarRespuesta()"
                [disabled]="!nuevaRespuesta.trim() || escribiendo">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8">
            </path>
          </svg>
        </button>
      </div>
      
      <button class="btn-finalizar" (click)="finalizarConversacion()">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M6 18L18 6M6 6l12 12">
          </path>
        </svg>
        Finalizar
      </button>
    </div>

    <!-- Bot√≥n para nueva consulta -->
    <div class="nueva-consulta" *ngIf="!conversacionActiva && mensajes.length > 0">
      <button class="btn-nueva-consulta" (click)="iniciarConversacion()">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M12 4v16m8-8H4">
          </path>
        </svg>
        Nueva Evaluaci√≥n
      </button>
    </div>
  </ng-container>
</div>