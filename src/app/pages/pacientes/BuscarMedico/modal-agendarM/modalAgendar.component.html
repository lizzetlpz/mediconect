<div class="modal-overlay" *ngIf="isOpen" (click)="onCancelar()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="modal-header">
      <div class="header-content">
        <svg class="calendar-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        <h2>Agendar Cita Médica</h2>
      </div>
      <button class="close-button" (click)="onCancelar()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <!-- Body -->
    <div class="modal-body">
      <!-- Doctor Info -->
      <div class="doctor-info">
        <div class="doctor-avatar">
          <img *ngIf="doctor.foto" [src]="doctor.foto" [alt]="doctor.nombre">
          <svg *ngIf="!doctor.foto" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </div>
        <div class="doctor-details">
          <h3>{{ doctor.nombre }}</h3>
          <p class="especialidad">{{ doctor.especialidad }}</p>
          <p class="descripcion">{{ doctor.descripcion }}</p>
        </div>
        <div class="doctor-price">
          <span class="currency">$</span>
          <span class="amount">{{ doctor.precio }}</span>
          <span class="per-consult">por consulta</span>
        </div>
      </div>

      <!-- Tipo de Consulta -->
      <div class="form-group">
        <label class="form-label required">Tipo de Consulta</label>
        <div class="consulta-types">
          <button
            type="button"
            class="consulta-type-button"
            [class.active]="tipoConsulta === 'texto'"
            (click)="seleccionarTipoConsulta('texto')">
            <svg class="type-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <span class="type-title">Chat de Texto</span>
            <span class="type-subtitle">Mensajería en tiempo real</span>
          </button>

          <button
            type="button"
            class="consulta-type-button"
            [class.active]="tipoConsulta === 'video'"
            (click)="seleccionarTipoConsulta('video')">
            <svg class="type-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <polygon points="23 7 16 12 23 17 23 7"></polygon>
              <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
            </svg>
            <span class="type-title">Videollamada</span>
            <span class="type-subtitle">Consulta por video</span>
          </button>
        </div>
      </div>

      <!-- Fecha y Hora -->
      <div class="form-row">
        <div class="form-group">
          <label class="form-label required">Fecha de la Cita</label>
          <input
            type="date"
            class="form-input"
            [(ngModel)]="fecha"
            (change)="onFechaChange(fecha)"
            [min]="getTodayDate()"
            placeholder="dd/mm/aaaa">
        </div>

        <div class="form-group">
          <label class="form-label required">Hora</label>
          <select
            class="form-select"
            [(ngModel)]="hora"
            [disabled]="!fecha">
            <option value="" disabled selected>Primero selecciona una fecha</option>
            <option *ngFor="let horario of horariosDisponibles" [value]="horario">
              {{ horario }}
            </option>
          </select>
        </div>
      </div>

      <!-- Motivo de la Consulta -->
      <div class="form-group">
        <label class="form-label required">Motivo de la Consulta</label>
        <input
          type="text"
          class="form-input"
          [(ngModel)]="motivoConsulta"
          placeholder="Ej: Dolor de cabeza, revisión general, seguimiento...">
      </div>

      <!-- Síntomas -->
      <div class="form-group">
        <label class="form-label">Síntomas (Opcional)</label>
        <textarea
          class="form-textarea"
          [(ngModel)]="sintomas"
          rows="4"
          placeholder="Describe tus síntomas para que el médico pueda prepararse mejor..."></textarea>
      </div>

      <!-- Notas Adicionales -->
      <div class="form-group">
        <label class="form-label">Notas Adicionales (Opcional)</label>
        <textarea
          class="form-textarea"
          [(ngModel)]="notasAdicionales"
          rows="3"
          placeholder="Información adicional relevante para el médico..."></textarea>
      </div>

      <!-- Costo Info -->
      <div class="cost-info">
        <span class="cost-label">Costo de la Consulta:</span>
        <span class="cost-amount">${{ doctor.precio }}</span>
      </div>
      <p class="payment-note">El pago se procesará después de confirmar la cita</p>
    </div>

    <!-- Footer -->
    <div class="modal-footer">
      <button type="button" class="btn-cancel" (click)="onCancelar()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
        Cancelar
      </button>
      <button
        type="button"
        class="btn-confirm"
        [disabled]="!formularioValido"
        (click)="onConfirmar()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        Confirmar Cita
      </button>
    </div>
  </div>
</div>

<!-- Modal de Pago -->
<app-modal-pago
  (pagoCompletado)="onPagoCompletado($event)"
  (pagoCancelado)="onPagoCancelado()"
></app-modal-pago>
