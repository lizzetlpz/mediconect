<div class="dashboard-layout">
  <!-- Sidebar -->
  <appP></appP>

  <!-- Main Content -->
  <div class="main-content">
    <div class="container">
      <div class="header">
        <h1 class="title">Buscar Médico</h1>
        <p class="subtitle">Encuentra al especialista que necesitas</p>
      </div>

      <!-- Search Section -->
      <div class="search-section">
        <div class="search-input-wrapper">
          <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <input
            type="text"
            class="search-input"
            [(ngModel)]="searchQuery"
            placeholder="Buscar por nombre, especialidad o consultorio..."
          />
        </div>

        <div class="filters">
          <label class="filter-label">Especialidad:</label>
          <select class="filter-select" [(ngModel)]="especialidadFiltro">
            <option *ngFor="let esp of especialidades" [value]="esp">
              {{ esp }}
            </option>
          </select>
        </div>
      </div>

      <!-- Doctors List -->
      <div class="doctors-grid">
        <div *ngIf="medicosFiltrados.length === 0" class="empty-state">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          <p>No se encontraron médicos</p>
        </div>

        <div *ngFor="let medico of medicosFiltrados" class="doctor-card">
          <div class="doctor-header">
            <img [src]="medico.foto" [alt]="medico.nombre" class="doctor-photo">
            <div class="doctor-info">
              <h3 class="doctor-name">{{ medico.nombre }}</h3>
              <p class="doctor-specialty">{{ medico.especialidad }}</p>
              <div class="doctor-rating">
                <div class="stars">
                  <svg *ngFor="let star of getRatingStars(medico.rating)"
                       [class.star-full]="star === 'full'"
                       [class.star-half]="star === 'half'"
                       [class.star-empty]="star === 'empty'"
                       fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                  </svg>
                </div>
                <span class="rating-value">{{ medico.rating }}</span>
              </div>
            </div>
          </div>

          <p class="doctor-description">{{ medico.descripcion }}</p>

          <div class="doctor-details">
            <div class="detail-item">
              <svg class="detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
              </svg>
              <span>{{ medico.experiencia }} años de experiencia</span>
            </div>

            <div class="detail-item">
              <svg class="detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
              </svg>
              <span>{{ medico.consultorio }}</span>
            </div>

            <div class="detail-item">
              <svg class="detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span>{{ medico.disponibilidad }}</span>
            </div>

            <div class="detail-item">
              <svg class="detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              <span>{{ medico.ubicacion }}</span>
            </div>
          </div>

          <div class="doctor-footer">
            <div class="price-section">
              <span class="price-label">Consulta desde</span>
              <span class="price-value">${{ medico.precio }}</span>
            </div>
            <div class="action-buttons">
              <button class="btn-primary" (click)="abrirModal(medico)">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                Agendar Cita
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Agendar Cita -->
  <app-agendar-cita-modal
    *ngIf="medicoSeleccionado"
    #modalAgendarCita
    [doctor]="convertirMedicoADoctor(medicoSeleccionado)"
    (citaAgendada)="onCitaAgendada($event)"
  ></app-agendar-cita-modal>
</div>

<!-- Modal de Pago -->
<app-modal-pago
  (pagoCompletado)="onPagoCompletado($event)"
  (pagoCancelado)="onPagoCancelado()"
></app-modal-pago>
