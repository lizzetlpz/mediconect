<div class="dashboard-layout">
  <!-- Sidebar -->
  <appP/>

  <div class="container">
    <!-- ðŸ†• Header con botÃ³n Agendar Cita -->
    <div class="header-with-button">
      <h1 class="title">Citas MÃ©dicas</h1>
      <button class="btn-nueva-cita" (click)="openModal()">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Nueva Cita
      </button>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
        <div class="stat-card stat-card-blue">
            <div class="stat-content">
                <div>
                    <p class="stat-label">Total Citas</p>
                    <p class="stat-value">{{ stats.total }}</p>
                </div>
                <svg class="stat-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
            </div>
        </div>

        <div class="stat-card stat-card-yellow">
            <div class="stat-content">
                <div>
                    <p class="stat-label">Pendientes</p>
                    <p class="stat-value">{{ stats.pendientes }}</p>
                </div>
                <svg class="stat-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
            </div>
        </div>

        <div class="stat-card stat-card-green">
            <div class="stat-content">
                <div>
                    <p class="stat-label">Confirmadas</p>
                    <p class="stat-value">{{ stats.confirmadas }}</p>
                </div>
                <svg class="stat-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="8.5" cy="7" r="4"></circle>
                    <polyline points="17 11 19 13 23 9"></polyline>
                </svg>
            </div>
        </div>

        <div class="stat-card stat-card-purple">
            <div class="stat-content">
                <div>
                    <p class="stat-label">Completadas</p>
                    <p class="stat-value">{{ stats.completadas }}</p>
                </div>
                <svg class="stat-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
            </div>
        </div>

        <div class="stat-card stat-card-red">
            <div class="stat-content">
                <div>
                    <p class="stat-label">Canceladas</p>
                    <p class="stat-value">{{ stats.canceladas }}</p>
                </div>
                <svg class="stat-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                </svg>
            </div>
        </div>
    </div>

    <!-- Search and Filters -->
    <div class="search-container">
        <div class="search-wrapper">
            <div class="search-input-wrapper">
                <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input
                    type="text"
                    class="search-input"
                    [(ngModel)]="searchQuery"
                    placeholder="Buscar por motivo o nÃºmero de cita..."
                />
            </div>
            <div class="filters">
                <button
                    class="filter-btn"
                    [class.filter-btn-active]="activeFilter === 'Todas'"
                    (click)="setFilter('Todas')">
                    Todas
                </button>
                <button
                    class="filter-btn"
                    [class.filter-btn-active]="activeFilter === 'Pendientes'"
                    (click)="setFilter('Pendientes')">
                    Pendientes
                </button>
                <button
                    class="filter-btn"
                    [class.filter-btn-active]="activeFilter === 'Confirmadas'"
                    (click)="setFilter('Confirmadas')">
                    Confirmadas
                </button>
                <button
                    class="filter-btn"
                    [class.filter-btn-active]="activeFilter === 'Canceladas'"
                    (click)="setFilter('Canceladas')">
                    Canceladas
                </button>
            </div>
        </div>
    </div>

    <!-- Appointments List -->
    <div class="appointments-list">
        <div *ngIf="filteredCitas.length === 0" style="text-align: center; padding: 3rem; color: #6b7280;">
            <p>No se encontraron citas</p>
        </div>

        <div *ngFor="let cita of filteredCitas" class="appointment-card">
            <div class="appointment-header">
                <div class="appointment-header-left">
                    <h3 class="appointment-id">Cita #{{ cita.id }}</h3>
                    <span class="status-badge" [ngClass]="getStatusClass(cita.estado)">
                        <span class="status-dot"></span>
                        {{ cita.estado }}
                    </span>
                </div>
                <button class="more-btn">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="1"></circle>
                        <circle cx="19" cy="12" r="1"></circle>
                        <circle cx="5" cy="12" r="1"></circle>
                    </svg>
                </button>
            </div>

            <p class="appointment-reason">{{ cita.motivo }}</p>

            <div class="appointment-people">
                <div>
                    <div class="person-label">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        Paciente
                    </div>
                    <p class="person-name">{{ cita.paciente.nombre }}</p>
                    <p class="person-detail">{{ cita.paciente.telefono }}</p>
                </div>

                <div>
                    <div class="person-label">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                        </svg>
                        MÃ©dico
                    </div>
                    <p class="person-name">{{ cita.medico.nombre }}</p>
                    <p class="person-detail">{{ cita.medico.especialidad }}</p>
                </div>
            </div>

            <div class="appointment-details">
                <div class="detail-item">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <span>{{ cita.fecha }}</span>
                </div>
                <div class="detail-item">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    <span>{{ cita.hora }}</span>
                </div>
                <div class="detail-item">
                    <svg *ngIf="cita.modalidad === 'Videollamada'" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M23 7l-7 5 7 5V7z"></path>
                        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                    </svg>
                    <svg *ngIf="cita.modalidad === 'Chat de texto'" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span>{{ cita.modalidad }}</span>
                </div>
            </div>

            <div class="appointment-notes">
                <div>
                    <p class="note-label">SÃ­ntomas:</p>
                    <p class="note-text">{{ cita.sintomas || '-' }}</p>
                </div>
                <div>
                    <p class="note-label">Notas:</p>
                    <p class="note-text">{{ cita.notas || '-' }}</p>
                </div>
            </div>

            <!-- BotÃ³n para unirse a videollamada -->
            <div 
                *ngIf="(cita.modalidad === 'Videollamada' || cita.modalidad === 'video' || cita.modalidad === 'videollamada') && (cita.estado === 'confirmada' || cita.estado === 'en_progreso')" 
                class="appointment-actions">
                <button class="btn-join-video" (click)="unirseVideollamada(cita)">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                    Unirse a videollamada
                </button>
            </div>
        </div>
    </div>
  </div>
</div>

<!-- ðŸ†• COMPONENTE MODAL -->
<app-modal-cita
  [show]="showModal"
  [pacientes]="pacientes"
  [medicos]="medicos"
  (close)="closeModal()"
  (citaCreada)="onCitaCreada($event)">
</app-modal-cita>
