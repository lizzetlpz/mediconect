<div class="modal-overlay" *ngIf="mostrarModal" (click)="cancelar()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="modal-header">
      <div class="header-content">
        <svg class="header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="8.5" cy="7" r="4"></circle>
          <line x1="20" y1="8" x2="20" y2="14"></line>
          <line x1="23" y1="11" x2="17" y2="11"></line>
        </svg>
        <h2>Registrar Nuevo Paciente</h2>
      </div>
      <button class="close-btn" (click)="cancelar()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <!-- Body -->
    <div class="modal-body">
      <!-- Mensaje de Error -->
      <div *ngIf="errorMessage" class="alert alert-error">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        {{ errorMessage }}
      </div>

      <!-- Información Personal -->
      <div class="form-section">
        <div class="form-row">
          <div class="form-group">
            <label>Nombre <span class="required">*</span></label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="nombre"
              placeholder="Nombre del paciente"
              [disabled]="isLoading">
          </div>

          <div class="form-group">
            <label>Apellido Paterno <span class="required">*</span></label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="apellido_paterno"
              placeholder="Apellido paterno"
              [disabled]="isLoading">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Apellido Materno</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="apellido_materno"
              placeholder="Apellido materno (opcional)"
              [disabled]="isLoading">
          </div>

          <div class="form-group">
            <label>Email <span class="required">*</span></label>
            <input
              type="email"
              class="form-control"
              [(ngModel)]="email"
              placeholder="correo@ejemplo.com"
              [disabled]="isLoading">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Teléfono <span class="required">*</span></label>
            <input
              type="tel"
              class="form-control"
              [(ngModel)]="telefono"
              placeholder="+52 55 1234 5678"
              [disabled]="isLoading">
          </div>

          <div class="form-group">
            <label>Fecha de Nacimiento</label>
            <input
              type="date"
              class="form-control"
              [(ngModel)]="fechaNacimiento"
              [disabled]="isLoading">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Género</label>
            <select class="form-control" [(ngModel)]="genero" [disabled]="isLoading">
              <option value="" disabled selected>Seleccionar género</option>
              <option *ngFor="let gen of generos" [value]="gen.value">
                {{ gen.label }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label>Tipo de Sangre</label>
            <select class="form-control" [(ngModel)]="tipoSangre" [disabled]="isLoading">
              <option value="" disabled selected>Seleccionar tipo</option>
              <option *ngFor="let tipo of tiposSangre" [value]="tipo.value">
                {{ tipo.label }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- Dirección -->
      <div class="form-section">
        <div class="form-group">
          <label>Dirección</label>
          <textarea
            class="form-control"
            [(ngModel)]="direccion"
            placeholder="Dirección completa..."
            rows="3"
            [disabled]="isLoading"></textarea>
        </div>
      </div>

      <!-- Contacto de Emergencia -->
      <div class="form-section">
        <div class="form-row">
          <div class="form-group">
            <label>Contacto de Emergencia</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="contactoEmergencia"
              placeholder="Nombre completo"
              [disabled]="isLoading">
          </div>

          <div class="form-group">
            <label>Teléfono de Emergencia</label>
            <input
              type="tel"
              class="form-control"
              [(ngModel)]="telefonoEmergencia"
              placeholder="+52 55 1234 5678"
              [disabled]="isLoading">
          </div>
        </div>
      </div>

      <!-- Información Médica -->
      <div class="form-section">
        <h3 class="section-title">Información Médica</h3>

        <div class="form-group">
          <label>Alergias</label>
          <textarea
            class="form-control"
            [(ngModel)]="alergias"
            placeholder="Describir alergias conocidas..."
            rows="3"
            [disabled]="isLoading"></textarea>
        </div>

        <div class="form-group">
          <label>Condiciones Crónicas</label>
          <textarea
            class="form-control"
            [(ngModel)]="condicionesCronicas"
            placeholder="Diabetes, hipertensión, etc..."
            rows="3"
            [disabled]="isLoading"></textarea>
        </div>

        <div class="form-group">
          <label>Medicamentos Actuales</label>
          <textarea
            class="form-control"
            [(ngModel)]="medicamentosActuales"
            placeholder="Medicamentos que toma actualmente..."
            rows="3"
            [disabled]="isLoading"></textarea>
        </div>
      </div>

      <!-- Información de Seguro -->
      <div class="form-section">
        <h3 class="section-title">Información de Seguro</h3>

        <div class="form-row">
          <div class="form-group">
            <label>Proveedor de Seguro</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="proveedorSeguro"
              placeholder="Nombre de la aseguradora"
              [disabled]="isLoading">
          </div>

          <div class="form-group">
            <label>Número de Póliza</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="numeroPoliza"
              placeholder="Número de póliza"
              [disabled]="isLoading">
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="modal-footer">
      <button class="btn-cancel" (click)="cancelar()" [disabled]="isLoading">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
        Cancelar
      </button>
      <button class="btn-save" (click)="registrarPaciente()" [disabled]="isLoading">
        <svg *ngIf="!isLoading" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
          <polyline points="17 21 17 13 7 13 7 21"></polyline>
          <polyline points="7 3 7 8 15 8"></polyline>
        </svg>
        <span class="spinner" *ngIf="isLoading"></span>
        {{ isLoading ? 'Registrando...' : 'Registrar Paciente' }}
      </button>
    </div>
  </div>
</div>
